"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8526],{8526:function(e,s,a){a.r(s);var t=a(5893),n=a(7294);a(9332),a(2066),a(5675);var l=a(9356);a(9182),a(1163);var r=a(5121),i=a(2621),c=a(1664),d=a.n(c);s.default=e=>{let{evaluation_id:s}=e,[a,c]=(0,n.useState)([]),{session:o}=(0,l.ll)(),{isLoaded:u,userId:h,sessionId:x,getToken:m,orgId:p}=(0,l.aC)(),[g,j]=(0,n.useState)(""),[b,_]=(0,n.useState)(!1),[v,N]=(0,n.useState)(0),[w,f]=(0,n.useState)(""),[S,y]=(0,n.useState)(""),[k,C]=(0,n.useState)(""),[F,A]=(0,n.useState)(0),[E,q]=(0,n.useState)(""),[O,R]=(0,n.useState)(""),[I,L]=(0,n.useState)(!1),[D,J]=(0,n.useState)(0),[M,Q]=(0,n.useState)(!1),[T,z]=(0,n.useState)([]),[Z,B]=(0,n.useState)(null),[G,H]=(0,n.useState)([]),K="px-4 py-2 leading-5 text-center bg-gray-50 text-sm text-gray-900 tracking-wider",P="px-6 py-4 leading-5 text-center bg-white text-sm text-gray-900 tracking-wider whitespace-no-wrap leading-5",[U,V]=(0,n.useState)("asc"),[W,X]=(0,n.useState)(0),Y=async()=>{try{if(!Z)return;Q(!0),_(!0);let e=(await r.Z.get("".concat("http://0.0.0.0:8000","/api/evaluation/chat"),{params:{evaluation_id:s,org_id:o.lastActiveOrganizationId,user_id:h,skip:0,limit:100,filter_score:W,simulation_run_id:parseInt(Z)}})).data;c(e)}catch(e){console.error("Error fetching QA data:",e)}finally{_(!1),Q(!1)}},$=async()=>{try{_(!0);let e=await r.Z.get("".concat("http://0.0.0.0:8000","/api/evaluation/id"),{params:{user_id:h,org_id:o.lastActiveOrganizationId,evaluation_id:s,org_id:o.lastActiveOrganizationId}}),a=e.data[0];R(a.simulation_name),q(a.simulation_id),C(a.last_updated),A(a.number_of_evaluations),N(a.average_score),f(a.dataset_name),y(a.endpoint_name),J(a.distinct_users),z(e.data),H(e.data.map(e=>e.simulation_run_id)),Z||B(e.data[0].simulation_run_id)}catch(e){console.error("Error fetching dataset details:",e)}finally{_(!1)}},ee=e=>{let s=[e.score.toFixed(4)],a=s.reduce((e,s)=>e+parseFloat(s),0)/s.length;return isNaN(a)?"N/A":a.toFixed(4)};return((0,n.useEffect)(()=>{$(),Y(),B(Z)},[o,Z,W]),o&&s&&E)?(0,t.jsx)("main",{className:"p-4 md:p-10 mx-auto max-w-7xl",children:(0,t.jsx)("div",{children:o?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-6 flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md",children:G.length>0&&(0,t.jsx)(i.Dashboard,{number_of_evaluations:F,mean_score:v.toFixed(4),distinct_users_simulated:D,evaluations:T,total_simulations:G.length})}),(0,t.jsxs)("div",{className:"mb-6 flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md",children:[(0,t.jsxs)("div",{className:"font-bold",children:["Total Chat QA Data: ",(0,t.jsx)("span",{className:"text-gray-700 font-normal",children:a.length})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("label",{htmlFor:"simulationRunIdSelect",className:"font-bold",children:"Select Evaluation Run ID:"}),(0,t.jsxs)("select",{id:"simulationRunIdSelect",onChange:e=>{B(e.target.value)},value:Z,className:"border border-gray-300 rounded-md w-36 py-1 text-sm text-gray-700 bg-white hover:border-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"",children:"Select Run ID"}),G.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsx)("button",{onClick:()=>{Y()},className:"bg-gray-900 hover:bg-gray-500 text-white px-4 py-2 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-300 disabled:opacity-50",disabled:b,children:b?"Submitting...":"Filter Scores above Threshold"}),(0,t.jsx)("input",{type:"text",value:W,placeholder:"Score Threshold",onChange:e=>{X(e.target.value)},className:"border border-gray-300 rounded-md w-24 px-2 py-1 text-sm text-gray-700 focus:border-blue-500"})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-10 gap-2 text-sm",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("div",{className:"font-bold mb-2",children:"Last evaluation run at:"}),(0,t.jsx)("div",{className:"text-gray-700",children:new Date(k).toLocaleString()})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("div",{className:"font-bold mb-2",children:"Dataset:"}),(0,t.jsx)("div",{className:"text-gray-700",children:w})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("div",{className:"font-bold mb-2",children:"LLM Endpoint:"}),(0,t.jsx)("div",{className:"text-gray-700",children:S})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("div",{className:"font-bold mb-2",children:"Evaluation Name:"}),(0,t.jsx)("div",{className:"text-blue-500",children:(0,t.jsx)(d(),{href:"/view/simulation/".concat(E),children:O})})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("div",{className:"font-bold mb-2",children:"Selected Sim Run Id:"}),(0,t.jsx)("div",{className:"text-gray-700",children:Z})]})]})}),(0,t.jsxs)("table",{className:"w-full mt-2 border-collapse border table-auto",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:K,children:"Timestamp"}),(0,t.jsx)("th",{className:K,children:"Chat Messages"}),(0,t.jsxs)("th",{className:K,onClick:()=>{V("asc"===U?"desc":"asc"),c(a.slice().sort((e,s)=>{let a=ee(e),t=ee(s);return"asc"===U?a-t:t-a}))},style:{cursor:"pointer"},children:["Mean Score","asc"===U?" ▲":" ▼"]}),(0,t.jsx)("th",{className:K,children:"Reference Chunk"})]})}),(0,t.jsx)("tbody",{children:a.map(e=>(0,t.jsxs)(n.Fragment,{children:[I===e.id&&(0,t.jsx)("tr",{className:"border-b",children:(0,t.jsx)("td",{colSpan:4,className:"px-6 py-4 leading-5 bg-white text-sm text-gray-900 tracking-wider whitespace-no-wrap leading-5",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"Reference Chunk:"})}),(0,t.jsx)("p",{children:e.reference_chunk})]})})}),(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("td",{className:P,style:{"vertical-align":"top"},children:new Date(e.timestamp).toLocaleString()}),(0,t.jsx)("td",{className:P,children:(0,t.jsxs)("ul",{className:"text-left space-y-4",children:[JSON.parse(e.chat_messages).question_answer&&(0,t.jsxs)("li",{className:"mb-2",children:[(0,t.jsx)("strong",{children:"Question:"})," ",JSON.parse(e.chat_messages).question_answer.question,(0,t.jsx)("br",{}),(0,t.jsx)("strong",{children:"Answer:"})," ",JSON.parse(e.chat_messages).question_answer.answer,(0,t.jsx)("br",{}),(0,t.jsx)("strong",{children:"LLM Endpoint Answer:"})," ",e.endpoint_response,(0,t.jsx)("br",{}),(0,t.jsx)("strong",{children:"Score: "})," ",e.score.toFixed(4)]}),JSON.parse(e.chat_messages).question_answer&&[...[,,,].keys()].map(s=>JSON.parse(e.chat_messages).question_answer["follow_up_question_".concat(s+1)]&&(0,t.jsxs)("li",{children:[(0,t.jsxs)("strong",{children:["Follow-up Question ",s+1,": "]}),JSON.parse(e.chat_messages).question_answer["follow_up_question_".concat(s+1)],","," ",(0,t.jsx)("br",{}),(0,t.jsxs)("strong",{children:["Follow-up Answer ",s+1,": "]})," ",JSON.parse(e.chat_messages).question_answer["follow_up_answer_".concat(s+1)],(0,t.jsx)("br",{}),(0,t.jsxs)("strong",{children:["LLM Endpoint Follow-up Answer ",s+1,": "]})," ",e.endpoint_response,(0,t.jsx)("br",{}),(0,t.jsx)("strong",{children:"Score: "})," ",e.score.toFixed(4)]},s+1))]})}),(0,t.jsx)("td",{className:P,style:{"vertical-align":"top"},children:ee(e)}),(0,t.jsx)("td",{className:P,style:{"vertical-align":"top"},children:(0,t.jsx)("button",{className:"text-blue-500 underline cursor-pointer",onClick:()=>L(I===e.id?null:e.id),children:I===e.id?"Collapse Reference":"Expand Reference"})})]})]},e.id))})]})]}):(0,t.jsx)("div",{children:b||M?(0,t.jsx)(t.Fragment,{}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{children:["Chat QA data evaluation is in progress for evaluation id - ",(0,t.jsx)("span",{className:"font-bold",children:s})]}),(0,t.jsx)("button",{className:"bg-gray-700 text-sm text-white px-4 py-2 rounded-md mt-4",onClick:()=>{$(),Y()},disabled:b,children:"Refresh"})]})})})}):null}}}]);